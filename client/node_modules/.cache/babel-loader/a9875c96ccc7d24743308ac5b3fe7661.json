{"ast":null,"code":"import { Plugin } from 'prosemirror-state';\nimport { dropPoint } from 'prosemirror-transform'; // :: (options: ?Object) → Plugin\n// Create a plugin that, when added to a ProseMirror instance,\n// causes a decoration to show up at the drop position when something\n// is dragged over the editor.\n//\n//   options::- These options are supported:\n//\n//     color:: ?string\n//     The color of the cursor. Defaults to `black`.\n//\n//     width:: ?number\n//     The precise width of the cursor in pixels. Defaults to 1.\n//\n//     class:: ?string\n//     A CSS class name to add to the cursor element.\n\nfunction dropCursor(options) {\n  if (options === void 0) options = {};\n  return new Plugin({\n    view: function view(editorView) {\n      return new DropCursorView(editorView, options);\n    }\n  });\n}\n\nvar DropCursorView = function DropCursorView(editorView, options) {\n  var this$1 = this;\n  this.editorView = editorView;\n  this.width = options.width || 1;\n  this.color = options.color || \"black\";\n  this.class = options.class;\n  this.cursorPos = null;\n  this.element = null;\n  this.timeout = null;\n  this.handlers = [\"dragover\", \"dragend\", \"drop\", \"dragleave\"].map(function (name) {\n    var handler = function (e) {\n      return this$1[name](e);\n    };\n\n    editorView.dom.addEventListener(name, handler);\n    return {\n      name: name,\n      handler: handler\n    };\n  });\n};\n\nDropCursorView.prototype.destroy = function destroy() {\n  var this$1 = this;\n  this.handlers.forEach(function (ref) {\n    var name = ref.name;\n    var handler = ref.handler;\n    return this$1.editorView.dom.removeEventListener(name, handler);\n  });\n};\n\nDropCursorView.prototype.update = function update(editorView, prevState) {\n  if (this.cursorPos != null && prevState.doc != editorView.state.doc) {\n    this.updateOverlay();\n  }\n};\n\nDropCursorView.prototype.setCursor = function setCursor(pos) {\n  if (pos == this.cursorPos) {\n    return;\n  }\n\n  this.cursorPos = pos;\n\n  if (pos == null) {\n    this.element.parentNode.removeChild(this.element);\n    this.element = null;\n  } else {\n    this.updateOverlay();\n  }\n};\n\nDropCursorView.prototype.updateOverlay = function updateOverlay() {\n  var $pos = this.editorView.state.doc.resolve(this.cursorPos),\n      rect;\n\n  if (!$pos.parent.inlineContent) {\n    var before = $pos.nodeBefore,\n        after = $pos.nodeAfter;\n\n    if (before || after) {\n      var nodeRect = this.editorView.nodeDOM(this.cursorPos - (before ? before.nodeSize : 0)).getBoundingClientRect();\n      var top = before ? nodeRect.bottom : nodeRect.top;\n\n      if (before && after) {\n        top = (top + this.editorView.nodeDOM(this.cursorPos).getBoundingClientRect().top) / 2;\n      }\n\n      rect = {\n        left: nodeRect.left,\n        right: nodeRect.right,\n        top: top - this.width / 2,\n        bottom: top + this.width / 2\n      };\n    }\n  }\n\n  if (!rect) {\n    var coords = this.editorView.coordsAtPos(this.cursorPos);\n    rect = {\n      left: coords.left - this.width / 2,\n      right: coords.left + this.width / 2,\n      top: coords.top,\n      bottom: coords.bottom\n    };\n  }\n\n  var parent = this.editorView.dom.offsetParent;\n\n  if (!this.element) {\n    this.element = parent.appendChild(document.createElement(\"div\"));\n\n    if (this.class) {\n      this.element.className = this.class;\n    }\n\n    this.element.style.cssText = \"position: absolute; z-index: 50; pointer-events: none; background-color: \" + this.color;\n  }\n\n  var parentRect = !parent || parent == document.body && getComputedStyle(parent).position == \"static\" ? {\n    left: -pageXOffset,\n    top: -pageYOffset\n  } : parent.getBoundingClientRect();\n  this.element.style.left = rect.left - parentRect.left + \"px\";\n  this.element.style.top = rect.top - parentRect.top + \"px\";\n  this.element.style.width = rect.right - rect.left + \"px\";\n  this.element.style.height = rect.bottom - rect.top + \"px\";\n};\n\nDropCursorView.prototype.scheduleRemoval = function scheduleRemoval(timeout) {\n  var this$1 = this;\n  clearTimeout(this.timeout);\n  this.timeout = setTimeout(function () {\n    return this$1.setCursor(null);\n  }, timeout);\n};\n\nDropCursorView.prototype.dragover = function dragover(event) {\n  if (!this.editorView.editable) {\n    return;\n  }\n\n  var pos = this.editorView.posAtCoords({\n    left: event.clientX,\n    top: event.clientY\n  });\n\n  if (pos) {\n    var target = pos.pos;\n\n    if (this.editorView.dragging && this.editorView.dragging.slice) {\n      target = dropPoint(this.editorView.state.doc, target, this.editorView.dragging.slice);\n\n      if (target == null) {\n        target = pos.pos;\n      }\n    }\n\n    this.setCursor(target);\n    this.scheduleRemoval(5000);\n  }\n};\n\nDropCursorView.prototype.dragend = function dragend() {\n  this.scheduleRemoval(20);\n};\n\nDropCursorView.prototype.drop = function drop() {\n  this.scheduleRemoval(20);\n};\n\nDropCursorView.prototype.dragleave = function dragleave(event) {\n  if (event.target == this.editorView.dom || !this.editorView.dom.contains(event.relatedTarget)) {\n    this.setCursor(null);\n  }\n};\n\nexport { dropCursor };","map":{"version":3,"sources":["../src/dropcursor.js"],"names":["let","this"],"mappings":"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","sourcesContent":["import {Plugin} from \"prosemirror-state\"\nimport {dropPoint} from \"prosemirror-transform\"\n\n// :: (options: ?Object) → Plugin\n// Create a plugin that, when added to a ProseMirror instance,\n// causes a decoration to show up at the drop position when something\n// is dragged over the editor.\n//\n//   options::- These options are supported:\n//\n//     color:: ?string\n//     The color of the cursor. Defaults to `black`.\n//\n//     width:: ?number\n//     The precise width of the cursor in pixels. Defaults to 1.\n//\n//     class:: ?string\n//     A CSS class name to add to the cursor element.\nexport function dropCursor(options = {}) {\n  return new Plugin({\n    view(editorView) { return new DropCursorView(editorView, options) }\n  })\n}\n\nclass DropCursorView {\n  constructor(editorView, options) {\n    this.editorView = editorView\n    this.width = options.width || 1\n    this.color = options.color || \"black\"\n    this.class = options.class\n    this.cursorPos = null\n    this.element = null\n    this.timeout = null\n\n    this.handlers = [\"dragover\", \"dragend\", \"drop\", \"dragleave\"].map(name => {\n      let handler = e => this[name](e)\n      editorView.dom.addEventListener(name, handler)\n      return {name, handler}\n    })\n  }\n\n  destroy() {\n    this.handlers.forEach(({name, handler}) => this.editorView.dom.removeEventListener(name, handler))\n  }\n\n  update(editorView, prevState) {\n    if (this.cursorPos != null && prevState.doc != editorView.state.doc) this.updateOverlay()\n  }\n\n  setCursor(pos) {\n    if (pos == this.cursorPos) return\n    this.cursorPos = pos\n    if (pos == null) {\n      this.element.parentNode.removeChild(this.element)\n      this.element = null\n    } else {\n      this.updateOverlay()\n    }\n  }\n\n  updateOverlay() {\n    let $pos = this.editorView.state.doc.resolve(this.cursorPos), rect\n    if (!$pos.parent.inlineContent) {\n      let before = $pos.nodeBefore, after = $pos.nodeAfter\n      if (before || after) {\n        let nodeRect = this.editorView.nodeDOM(this.cursorPos - (before ?  before.nodeSize : 0)).getBoundingClientRect()\n        let top = before ? nodeRect.bottom : nodeRect.top\n        if (before && after)\n          top = (top + this.editorView.nodeDOM(this.cursorPos).getBoundingClientRect().top) / 2\n        rect = {left: nodeRect.left, right: nodeRect.right, top: top - this.width / 2, bottom: top + this.width / 2}\n      }\n    }\n    if (!rect) {\n      let coords = this.editorView.coordsAtPos(this.cursorPos)\n      rect = {left: coords.left - this.width / 2, right: coords.left + this.width / 2, top: coords.top, bottom: coords.bottom}\n    }\n\n    let parent = this.editorView.dom.offsetParent\n    if (!this.element) {\n      this.element = parent.appendChild(document.createElement(\"div\"))\n      if (this.class) this.element.className = this.class\n      this.element.style.cssText = \"position: absolute; z-index: 50; pointer-events: none; background-color: \" + this.color\n    }\n    let parentRect = !parent || parent == document.body && getComputedStyle(parent).position == \"static\"\n        ? {left: -pageXOffset, top: -pageYOffset} : parent.getBoundingClientRect()\n    this.element.style.left = (rect.left - parentRect.left) + \"px\"\n    this.element.style.top = (rect.top - parentRect.top) + \"px\"\n    this.element.style.width = (rect.right - rect.left) + \"px\"\n    this.element.style.height = (rect.bottom - rect.top) + \"px\"\n  }\n\n  scheduleRemoval(timeout) {\n    clearTimeout(this.timeout)\n    this.timeout = setTimeout(() => this.setCursor(null), timeout)\n  }\n\n  dragover(event) {\n    if (!this.editorView.editable) return\n    let pos = this.editorView.posAtCoords({left: event.clientX, top: event.clientY})\n    if (pos) {\n      let target = pos.pos\n      if (this.editorView.dragging && this.editorView.dragging.slice) {\n        target = dropPoint(this.editorView.state.doc, target, this.editorView.dragging.slice)\n        if (target == null) target = pos.pos\n      }\n      this.setCursor(target)\n      this.scheduleRemoval(5000)\n    }\n  }\n\n  dragend() {\n    this.scheduleRemoval(20)\n  }\n\n  drop() {\n    this.scheduleRemoval(20)\n  }\n\n  dragleave(event) {\n    if (event.target == this.editorView.dom || !this.editorView.dom.contains(event.relatedTarget))\n      this.setCursor(null)\n  }\n}\n"]},"metadata":{},"sourceType":"module"}