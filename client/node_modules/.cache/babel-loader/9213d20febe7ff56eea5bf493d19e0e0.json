{"ast":null,"code":"import crel from 'crelt';\nimport { joinUp, lift, selectParentNode, setBlockType, wrapIn } from 'prosemirror-commands';\nimport { undo, redo } from 'prosemirror-history';\nimport { Plugin } from 'prosemirror-state';\nvar SVG = \"http://www.w3.org/2000/svg\";\nvar XLINK = \"http://www.w3.org/1999/xlink\";\nvar prefix = \"ProseMirror-icon\";\n\nfunction hashPath(path) {\n  var hash = 0;\n\n  for (var i = 0; i < path.length; i++) {\n    hash = (hash << 5) - hash + path.charCodeAt(i) | 0;\n  }\n\n  return hash;\n}\n\nfunction getIcon(icon) {\n  var node = document.createElement(\"div\");\n  node.className = prefix;\n\n  if (icon.path) {\n    var name = \"pm-icon-\" + hashPath(icon.path).toString(16);\n\n    if (!document.getElementById(name)) {\n      buildSVG(name, icon);\n    }\n\n    var svg = node.appendChild(document.createElementNS(SVG, \"svg\"));\n    svg.style.width = icon.width / icon.height + \"em\";\n    var use = svg.appendChild(document.createElementNS(SVG, \"use\"));\n    use.setAttributeNS(XLINK, \"href\", /([^#]*)/.exec(document.location)[1] + \"#\" + name);\n  } else if (icon.dom) {\n    node.appendChild(icon.dom.cloneNode(true));\n  } else {\n    node.appendChild(document.createElement(\"span\")).textContent = icon.text || '';\n\n    if (icon.css) {\n      node.firstChild.style.cssText = icon.css;\n    }\n  }\n\n  return node;\n}\n\nfunction buildSVG(name, data) {\n  var collection = document.getElementById(prefix + \"-collection\");\n\n  if (!collection) {\n    collection = document.createElementNS(SVG, \"svg\");\n    collection.id = prefix + \"-collection\";\n    collection.style.display = \"none\";\n    document.body.insertBefore(collection, document.body.firstChild);\n  }\n\n  var sym = document.createElementNS(SVG, \"symbol\");\n  sym.id = name;\n  sym.setAttribute(\"viewBox\", \"0 0 \" + data.width + \" \" + data.height);\n  var path = sym.appendChild(document.createElementNS(SVG, \"path\"));\n  path.setAttribute(\"d\", data.path);\n  collection.appendChild(sym);\n}\n\nvar prefix$1 = \"ProseMirror-menu\"; // ::- An icon or label that, when clicked, executes a command.\n\nvar MenuItem = function MenuItem(spec) {\n  // :: MenuItemSpec\n  // The spec used to create the menu item.\n  this.spec = spec;\n}; // :: (EditorView) → {dom: dom.Node, update: (EditorState) → bool}\n// Renders the icon according to its [display\n// spec](#menu.MenuItemSpec.display), and adds an event handler which\n// executes the command when the representation is clicked.\n\n\nMenuItem.prototype.render = function render(view) {\n  var spec = this.spec;\n  var dom = spec.render ? spec.render(view) : spec.icon ? getIcon(spec.icon) : spec.label ? crel(\"div\", null, translate(view, spec.label)) : null;\n\n  if (!dom) {\n    throw new RangeError(\"MenuItem without icon or label property\");\n  }\n\n  if (spec.title) {\n    var title = typeof spec.title === \"function\" ? spec.title(view.state) : spec.title;\n    dom.setAttribute(\"title\", translate(view, title));\n  }\n\n  if (spec.class) {\n    dom.classList.add(spec.class);\n  }\n\n  if (spec.css) {\n    dom.style.cssText += spec.css;\n  }\n\n  dom.addEventListener(\"mousedown\", function (e) {\n    e.preventDefault();\n\n    if (!dom.classList.contains(prefix$1 + \"-disabled\")) {\n      spec.run(view.state, view.dispatch, view, e);\n    }\n  });\n\n  function update(state) {\n    if (spec.select) {\n      var selected = spec.select(state);\n      dom.style.display = selected ? \"\" : \"none\";\n\n      if (!selected) {\n        return false;\n      }\n    }\n\n    var enabled = true;\n\n    if (spec.enable) {\n      enabled = spec.enable(state) || false;\n      setClass(dom, prefix$1 + \"-disabled\", !enabled);\n    }\n\n    if (spec.active) {\n      var active = enabled && spec.active(state) || false;\n      setClass(dom, prefix$1 + \"-active\", active);\n    }\n\n    return true;\n  }\n\n  return {\n    dom: dom,\n    update: update\n  };\n};\n\nfunction translate(view, text) {\n  return view._props.translate ? view._props.translate(text) : text;\n} // MenuItemSpec:: interface\n// The configuration object passed to the `MenuItem` constructor.\n//\n//   run:: (EditorState, (Transaction), EditorView, dom.Event)\n//   The function to execute when the menu item is activated.\n//\n//   select:: ?(EditorState) → bool\n//   Optional function that is used to determine whether the item is\n//   appropriate at the moment. Deselected items will be hidden.\n//\n//   enable:: ?(EditorState) → bool\n//   Function that is used to determine if the item is enabled. If\n//   given and returning false, the item will be given a disabled\n//   styling.\n//\n//   active:: ?(EditorState) → bool\n//   A predicate function to determine whether the item is 'active' (for\n//   example, the item for toggling the strong mark might be active then\n//   the cursor is in strong text).\n//\n//   render:: ?(EditorView) → dom.Node\n//   A function that renders the item. You must provide either this,\n//   [`icon`](#menu.MenuItemSpec.icon), or [`label`](#MenuItemSpec.label).\n//\n//   icon:: ?Object\n//   Describes an icon to show for this item. The object may specify\n//   an SVG icon, in which case its `path` property should be an [SVG\n//   path\n//   spec](https://developer.mozilla.org/en-US/docs/Web/SVG/Attribute/d),\n//   and `width` and `height` should provide the viewbox in which that\n//   path exists. Alternatively, it may have a `text` property\n//   specifying a string of text that makes up the icon, with an\n//   optional `css` property giving additional CSS styling for the\n//   text. _Or_ it may contain `dom` property containing a DOM node.\n//\n//   label:: ?string\n//   Makes the item show up as a text label. Mostly useful for items\n//   wrapped in a [drop-down](#menu.Dropdown) or similar menu. The object\n//   should have a `label` property providing the text to display.\n//\n//   title:: ?union<string, (EditorState) → string>\n//   Defines DOM title (mouseover) text for the item.\n//\n//   class:: ?string\n//   Optionally adds a CSS class to the item's DOM representation.\n//\n//   css:: ?string\n//   Optionally adds a string of inline CSS to the item's DOM\n//   representation.\n\n\nvar lastMenuEvent = {\n  time: 0,\n  node: null\n};\n\nfunction markMenuEvent(e) {\n  lastMenuEvent.time = Date.now();\n  lastMenuEvent.node = e.target;\n}\n\nfunction isMenuEvent(wrapper) {\n  return Date.now() - 100 < lastMenuEvent.time && lastMenuEvent.node && wrapper.contains(lastMenuEvent.node);\n} // ::- A drop-down menu, displayed as a label with a downwards-pointing\n// triangle to the right of it.\n\n\nvar Dropdown = function Dropdown(content, options) {\n  this.options = options || {};\n  this.content = Array.isArray(content) ? content : [content];\n}; // :: (EditorView) → {dom: dom.Node, update: (EditorState)}\n// Render the dropdown menu and sub-items.\n\n\nDropdown.prototype.render = function render(view) {\n  var this$1 = this;\n  var content = renderDropdownItems(this.content, view);\n  var label = crel(\"div\", {\n    class: prefix$1 + \"-dropdown \" + (this.options.class || \"\"),\n    style: this.options.css\n  }, translate(view, this.options.label));\n\n  if (this.options.title) {\n    label.setAttribute(\"title\", translate(view, this.options.title));\n  }\n\n  var wrap = crel(\"div\", {\n    class: prefix$1 + \"-dropdown-wrap\"\n  }, label);\n  var open = null,\n      listeningOnClose = null;\n\n  var close = function () {\n    if (open && open.close()) {\n      open = null;\n      window.removeEventListener(\"mousedown\", listeningOnClose);\n    }\n  };\n\n  label.addEventListener(\"mousedown\", function (e) {\n    e.preventDefault();\n    markMenuEvent(e);\n\n    if (open) {\n      close();\n    } else {\n      open = this$1.expand(wrap, content.dom);\n      window.addEventListener(\"mousedown\", listeningOnClose = function () {\n        if (!isMenuEvent(wrap)) {\n          close();\n        }\n      });\n    }\n  });\n\n  function update(state) {\n    var inner = content.update(state);\n    wrap.style.display = inner ? \"\" : \"none\";\n    return inner;\n  }\n\n  return {\n    dom: wrap,\n    update: update\n  };\n};\n\nDropdown.prototype.expand = function expand(dom, items) {\n  var menuDOM = crel(\"div\", {\n    class: prefix$1 + \"-dropdown-menu \" + (this.options.class || \"\")\n  }, items);\n  var done = false;\n\n  function close() {\n    if (done) {\n      return;\n    }\n\n    done = true;\n    dom.removeChild(menuDOM);\n    return true;\n  }\n\n  dom.appendChild(menuDOM);\n  return {\n    close: close,\n    node: menuDOM\n  };\n};\n\nfunction renderDropdownItems(items, view) {\n  var rendered = [],\n      updates = [];\n\n  for (var i = 0; i < items.length; i++) {\n    var ref = items[i].render(view);\n    var dom = ref.dom;\n    var update = ref.update;\n    rendered.push(crel(\"div\", {\n      class: prefix$1 + \"-dropdown-item\"\n    }, dom));\n    updates.push(update);\n  }\n\n  return {\n    dom: rendered,\n    update: combineUpdates(updates, rendered)\n  };\n}\n\nfunction combineUpdates(updates, nodes) {\n  return function (state) {\n    var something = false;\n\n    for (var i = 0; i < updates.length; i++) {\n      var up = updates[i](state);\n      nodes[i].style.display = up ? \"\" : \"none\";\n\n      if (up) {\n        something = true;\n      }\n    }\n\n    return something;\n  };\n} // ::- Represents a submenu wrapping a group of elements that start\n// hidden and expand to the right when hovered over or tapped.\n\n\nvar DropdownSubmenu = function DropdownSubmenu(content, options) {\n  this.options = options || {};\n  this.content = Array.isArray(content) ? content : [content];\n}; // :: (EditorView) → {dom: dom.Node, update: (EditorState) → bool}\n// Renders the submenu.\n\n\nDropdownSubmenu.prototype.render = function render(view) {\n  var items = renderDropdownItems(this.content, view);\n  var label = crel(\"div\", {\n    class: prefix$1 + \"-submenu-label\"\n  }, translate(view, this.options.label));\n  var wrap = crel(\"div\", {\n    class: prefix$1 + \"-submenu-wrap\"\n  }, label, crel(\"div\", {\n    class: prefix$1 + \"-submenu\"\n  }, items.dom));\n  var listeningOnClose = null;\n  label.addEventListener(\"mousedown\", function (e) {\n    e.preventDefault();\n    markMenuEvent(e);\n    setClass(wrap, prefix$1 + \"-submenu-wrap-active\");\n\n    if (!listeningOnClose) {\n      window.addEventListener(\"mousedown\", listeningOnClose = function () {\n        if (!isMenuEvent(wrap)) {\n          wrap.classList.remove(prefix$1 + \"-submenu-wrap-active\");\n          window.removeEventListener(\"mousedown\", listeningOnClose);\n          listeningOnClose = null;\n        }\n      });\n    }\n  });\n\n  function update(state) {\n    var inner = items.update(state);\n    wrap.style.display = inner ? \"\" : \"none\";\n    return inner;\n  }\n\n  return {\n    dom: wrap,\n    update: update\n  };\n}; // :: (EditorView, [union<MenuElement, [MenuElement]>]) → {dom: ?dom.DocumentFragment, update: (EditorState) → bool}\n// Render the given, possibly nested, array of menu elements into a\n// document fragment, placing separators between them (and ensuring no\n// superfluous separators appear when some of the groups turn out to\n// be empty).\n\n\nfunction renderGrouped(view, content) {\n  var result = document.createDocumentFragment();\n  var updates = [],\n      separators = [];\n\n  for (var i = 0; i < content.length; i++) {\n    var items = content[i],\n        localUpdates = [],\n        localNodes = [];\n\n    for (var j = 0; j < items.length; j++) {\n      var ref = items[j].render(view);\n      var dom = ref.dom;\n      var update$1 = ref.update;\n      var span = crel(\"span\", {\n        class: prefix$1 + \"item\"\n      }, dom);\n      result.appendChild(span);\n      localNodes.push(span);\n      localUpdates.push(update$1);\n    }\n\n    if (localUpdates.length) {\n      updates.push(combineUpdates(localUpdates, localNodes));\n\n      if (i < content.length - 1) {\n        separators.push(result.appendChild(separator()));\n      }\n    }\n  }\n\n  function update(state) {\n    var something = false,\n        needSep = false;\n\n    for (var i = 0; i < updates.length; i++) {\n      var hasContent = updates[i](state);\n\n      if (i) {\n        separators[i - 1].style.display = needSep && hasContent ? \"\" : \"none\";\n      }\n\n      needSep = hasContent;\n\n      if (hasContent) {\n        something = true;\n      }\n    }\n\n    return something;\n  }\n\n  return {\n    dom: result,\n    update: update\n  };\n}\n\nfunction separator() {\n  return crel(\"span\", {\n    class: prefix$1 + \"separator\"\n  });\n} // :: Object\n// A set of basic editor-related icons. Contains the properties\n// `join`, `lift`, `selectParentNode`, `undo`, `redo`, `strong`, `em`,\n// `code`, `link`, `bulletList`, `orderedList`, and `blockquote`, each\n// holding an object that can be used as the `icon` option to\n// `MenuItem`.\n\n\nvar icons = {\n  join: {\n    width: 800,\n    height: 900,\n    path: \"M0 75h800v125h-800z M0 825h800v-125h-800z M250 400h100v-100h100v100h100v100h-100v100h-100v-100h-100z\"\n  },\n  lift: {\n    width: 1024,\n    height: 1024,\n    path: \"M219 310v329q0 7-5 12t-12 5q-8 0-13-5l-164-164q-5-5-5-13t5-13l164-164q5-5 13-5 7 0 12 5t5 12zM1024 749v109q0 7-5 12t-12 5h-987q-7 0-12-5t-5-12v-109q0-7 5-12t12-5h987q7 0 12 5t5 12zM1024 530v109q0 7-5 12t-12 5h-621q-7 0-12-5t-5-12v-109q0-7 5-12t12-5h621q7 0 12 5t5 12zM1024 310v109q0 7-5 12t-12 5h-621q-7 0-12-5t-5-12v-109q0-7 5-12t12-5h621q7 0 12 5t5 12zM1024 91v109q0 7-5 12t-12 5h-987q-7 0-12-5t-5-12v-109q0-7 5-12t12-5h987q7 0 12 5t5 12z\"\n  },\n  selectParentNode: {\n    text: \"\\u2b1a\",\n    css: \"font-weight: bold\"\n  },\n  undo: {\n    width: 1024,\n    height: 1024,\n    path: \"M761 1024c113-206 132-520-313-509v253l-384-384 384-384v248c534-13 594 472 313 775z\"\n  },\n  redo: {\n    width: 1024,\n    height: 1024,\n    path: \"M576 248v-248l384 384-384 384v-253c-446-10-427 303-313 509-280-303-221-789 313-775z\"\n  },\n  strong: {\n    width: 805,\n    height: 1024,\n    path: \"M317 869q42 18 80 18 214 0 214-191 0-65-23-102-15-25-35-42t-38-26-46-14-48-6-54-1q-41 0-57 5 0 30-0 90t-0 90q0 4-0 38t-0 55 2 47 6 38zM309 442q24 4 62 4 46 0 81-7t62-25 42-51 14-81q0-40-16-70t-45-46-61-24-70-8q-28 0-74 7 0 28 2 86t2 86q0 15-0 45t-0 45q0 26 0 39zM0 950l1-53q8-2 48-9t60-15q4-6 7-15t4-19 3-18 1-21 0-19v-37q0-561-12-585-2-4-12-8t-25-6-28-4-27-2-17-1l-2-47q56-1 194-6t213-5q13 0 39 0t38 0q40 0 78 7t73 24 61 40 42 59 16 78q0 29-9 54t-22 41-36 32-41 25-48 22q88 20 146 76t58 141q0 57-20 102t-53 74-78 48-93 27-100 8q-25 0-75-1t-75-1q-60 0-175 6t-132 6z\"\n  },\n  em: {\n    width: 585,\n    height: 1024,\n    path: \"M0 949l9-48q3-1 46-12t63-21q16-20 23-57 0-4 35-165t65-310 29-169v-14q-13-7-31-10t-39-4-33-3l10-58q18 1 68 3t85 4 68 1q27 0 56-1t69-4 56-3q-2 22-10 50-17 5-58 16t-62 19q-4 10-8 24t-5 22-4 26-3 24q-15 84-50 239t-44 203q-1 5-7 33t-11 51-9 47-3 32l0 10q9 2 105 17-1 25-9 56-6 0-18 0t-18 0q-16 0-49-5t-49-5q-78-1-117-1-29 0-81 5t-69 6z\"\n  },\n  code: {\n    width: 896,\n    height: 1024,\n    path: \"M608 192l-96 96 224 224-224 224 96 96 288-320-288-320zM288 192l-288 320 288 320 96-96-224-224 224-224-96-96z\"\n  },\n  link: {\n    width: 951,\n    height: 1024,\n    path: \"M832 694q0-22-16-38l-118-118q-16-16-38-16-24 0-41 18 1 1 10 10t12 12 8 10 7 14 2 15q0 22-16 38t-38 16q-8 0-15-2t-14-7-10-8-12-12-10-10q-18 17-18 41 0 22 16 38l117 118q15 15 38 15 22 0 38-14l84-83q16-16 16-38zM430 292q0-22-16-38l-117-118q-16-16-38-16-22 0-38 15l-84 83q-16 16-16 38 0 22 16 38l118 118q15 15 38 15 24 0 41-17-1-1-10-10t-12-12-8-10-7-14-2-15q0-22 16-38t38-16q8 0 15 2t14 7 10 8 12 12 10 10q18-17 18-41zM941 694q0 68-48 116l-84 83q-47 47-116 47-69 0-116-48l-117-118q-47-47-47-116 0-70 50-119l-50-50q-49 50-118 50-68 0-116-48l-118-118q-48-48-48-116t48-116l84-83q47-47 116-47 69 0 116 48l117 118q47 47 47 116 0 70-50 119l50 50q49-50 118-50 68 0 116 48l118 118q48 48 48 116z\"\n  },\n  bulletList: {\n    width: 768,\n    height: 896,\n    path: \"M0 512h128v-128h-128v128zM0 256h128v-128h-128v128zM0 768h128v-128h-128v128zM256 512h512v-128h-512v128zM256 256h512v-128h-512v128zM256 768h512v-128h-512v128z\"\n  },\n  orderedList: {\n    width: 768,\n    height: 896,\n    path: \"M320 512h448v-128h-448v128zM320 768h448v-128h-448v128zM320 128v128h448v-128h-448zM79 384h78v-256h-36l-85 23v50l43-2v185zM189 590c0-36-12-78-96-78-33 0-64 6-83 16l1 66c21-10 42-15 67-15s32 11 32 28c0 26-30 58-110 112v50h192v-67l-91 2c49-30 87-66 87-113l1-1z\"\n  },\n  blockquote: {\n    width: 640,\n    height: 896,\n    path: \"M0 448v256h256v-256h-128c0 0 0-128 128-128v-128c0 0-256 0-256 256zM640 320v-128c0 0-256 0-256 256v256h256v-256h-128c0 0 0-128 128-128z\"\n  }\n}; // :: MenuItem\n// Menu item for the `joinUp` command.\n\nvar joinUpItem = new MenuItem({\n  title: \"Join with above block\",\n  run: joinUp,\n  select: function (state) {\n    return joinUp(state);\n  },\n  icon: icons.join\n}); // :: MenuItem\n// Menu item for the `lift` command.\n\nvar liftItem = new MenuItem({\n  title: \"Lift out of enclosing block\",\n  run: lift,\n  select: function (state) {\n    return lift(state);\n  },\n  icon: icons.lift\n}); // :: MenuItem\n// Menu item for the `selectParentNode` command.\n\nvar selectParentNodeItem = new MenuItem({\n  title: \"Select parent node\",\n  run: selectParentNode,\n  select: function (state) {\n    return selectParentNode(state);\n  },\n  icon: icons.selectParentNode\n}); // :: MenuItem\n// Menu item for the `undo` command.\n\nvar undoItem = new MenuItem({\n  title: \"Undo last change\",\n  run: undo,\n  enable: function (state) {\n    return undo(state);\n  },\n  icon: icons.undo\n}); // :: MenuItem\n// Menu item for the `redo` command.\n\nvar redoItem = new MenuItem({\n  title: \"Redo last undone change\",\n  run: redo,\n  enable: function (state) {\n    return redo(state);\n  },\n  icon: icons.redo\n}); // :: (NodeType, Object) → MenuItem\n// Build a menu item for wrapping the selection in a given node type.\n// Adds `run` and `select` properties to the ones present in\n// `options`. `options.attrs` may be an object or a function.\n\nfunction wrapItem(nodeType, options) {\n  var passedOptions = {\n    run: function run(state, dispatch) {\n      // FIXME if (options.attrs instanceof Function) options.attrs(state, attrs => wrapIn(nodeType, attrs)(state))\n      return wrapIn(nodeType, options.attrs)(state, dispatch);\n    },\n    select: function select(state) {\n      return wrapIn(nodeType, options.attrs instanceof Function ? null : options.attrs)(state);\n    }\n  };\n\n  for (var prop in options) {\n    passedOptions[prop] = options[prop];\n  }\n\n  return new MenuItem(passedOptions);\n} // :: (NodeType, Object) → MenuItem\n// Build a menu item for changing the type of the textblock around the\n// selection to the given type. Provides `run`, `active`, and `select`\n// properties. Others must be given in `options`. `options.attrs` may\n// be an object to provide the attributes for the textblock node.\n\n\nfunction blockTypeItem(nodeType, options) {\n  var command = setBlockType(nodeType, options.attrs);\n  var passedOptions = {\n    run: command,\n    enable: function enable(state) {\n      return command(state);\n    },\n    active: function active(state) {\n      var ref = state.selection;\n      var $from = ref.$from;\n      var to = ref.to;\n      var node = ref.node;\n\n      if (node) {\n        return node.hasMarkup(nodeType, options.attrs);\n      }\n\n      return to <= $from.end() && $from.parent.hasMarkup(nodeType, options.attrs);\n    }\n  };\n\n  for (var prop in options) {\n    passedOptions[prop] = options[prop];\n  }\n\n  return new MenuItem(passedOptions);\n} // Work around classList.toggle being broken in IE11\n\n\nfunction setClass(dom, cls, on) {\n  if (on) {\n    dom.classList.add(cls);\n  } else {\n    dom.classList.remove(cls);\n  }\n}\n\nvar prefix$2 = \"ProseMirror-menubar\";\n\nfunction isIOS() {\n  if (typeof navigator == \"undefined\") {\n    return false;\n  }\n\n  var agent = navigator.userAgent;\n  return !/Edge\\/\\d/.test(agent) && /AppleWebKit/.test(agent) && /Mobile\\/\\w+/.test(agent);\n} // :: (Object) → Plugin\n// A plugin that will place a menu bar above the editor. Note that\n// this involves wrapping the editor in an additional `<div>`.\n//\n//   options::-\n//   Supports the following options:\n//\n//     content:: [[MenuElement]]\n//     Provides the content of the menu, as a nested array to be\n//     passed to `renderGrouped`.\n//\n//     floating:: ?bool\n//     Determines whether the menu floats, i.e. whether it sticks to\n//     the top of the viewport when the editor is partially scrolled\n//     out of view.\n\n\nfunction menuBar(options) {\n  return new Plugin({\n    view: function view(editorView) {\n      return new MenuBarView(editorView, options);\n    }\n  });\n}\n\nvar MenuBarView = function MenuBarView(editorView, options) {\n  var this$1 = this;\n  this.editorView = editorView;\n  this.options = options;\n  this.wrapper = crel(\"div\", {\n    class: prefix$2 + \"-wrapper\"\n  });\n  this.menu = this.wrapper.appendChild(crel(\"div\", {\n    class: prefix$2\n  }));\n  this.menu.className = prefix$2;\n  this.spacer = null;\n  editorView.dom.parentNode.replaceChild(this.wrapper, editorView.dom);\n  this.wrapper.appendChild(editorView.dom);\n  this.maxHeight = 0;\n  this.widthForMaxHeight = 0;\n  this.floating = false;\n  var ref = renderGrouped(this.editorView, this.options.content);\n  var dom = ref.dom;\n  var update = ref.update;\n  this.contentUpdate = update;\n  this.menu.appendChild(dom);\n  this.update();\n\n  if (options.floating && !isIOS()) {\n    this.updateFloat();\n    var potentialScrollers = getAllWrapping(this.wrapper);\n\n    this.scrollFunc = function (e) {\n      var root = this$1.editorView.root;\n\n      if (!(root.body || root).contains(this$1.wrapper)) {\n        potentialScrollers.forEach(function (el) {\n          return el.removeEventListener(\"scroll\", this$1.scrollFunc);\n        });\n      } else {\n        this$1.updateFloat(e.target.getBoundingClientRect && e.target);\n      }\n    };\n\n    potentialScrollers.forEach(function (el) {\n      return el.addEventListener('scroll', this$1.scrollFunc);\n    });\n  }\n};\n\nMenuBarView.prototype.update = function update() {\n  this.contentUpdate(this.editorView.state);\n\n  if (this.floating) {\n    this.updateScrollCursor();\n  } else {\n    if (this.menu.offsetWidth != this.widthForMaxHeight) {\n      this.widthForMaxHeight = this.menu.offsetWidth;\n      this.maxHeight = 0;\n    }\n\n    if (this.menu.offsetHeight > this.maxHeight) {\n      this.maxHeight = this.menu.offsetHeight;\n      this.menu.style.minHeight = this.maxHeight + \"px\";\n    }\n  }\n};\n\nMenuBarView.prototype.updateScrollCursor = function updateScrollCursor() {\n  var selection = this.editorView.root.getSelection();\n\n  if (!selection.focusNode) {\n    return;\n  }\n\n  var rects = selection.getRangeAt(0).getClientRects();\n  var selRect = rects[selectionIsInverted(selection) ? 0 : rects.length - 1];\n\n  if (!selRect) {\n    return;\n  }\n\n  var menuRect = this.menu.getBoundingClientRect();\n\n  if (selRect.top < menuRect.bottom && selRect.bottom > menuRect.top) {\n    var scrollable = findWrappingScrollable(this.wrapper);\n\n    if (scrollable) {\n      scrollable.scrollTop -= menuRect.bottom - selRect.top;\n    }\n  }\n};\n\nMenuBarView.prototype.updateFloat = function updateFloat(scrollAncestor) {\n  var parent = this.wrapper,\n      editorRect = parent.getBoundingClientRect(),\n      top = scrollAncestor ? Math.max(0, scrollAncestor.getBoundingClientRect().top) : 0;\n\n  if (this.floating) {\n    if (editorRect.top >= top || editorRect.bottom < this.menu.offsetHeight + 10) {\n      this.floating = false;\n      this.menu.style.position = this.menu.style.left = this.menu.style.top = this.menu.style.width = \"\";\n      this.menu.style.display = \"\";\n      this.spacer.parentNode.removeChild(this.spacer);\n      this.spacer = null;\n    } else {\n      var border = (parent.offsetWidth - parent.clientWidth) / 2;\n      this.menu.style.left = editorRect.left + border + \"px\";\n      this.menu.style.display = editorRect.top > window.innerHeight ? \"none\" : \"\";\n\n      if (scrollAncestor) {\n        this.menu.style.top = top + \"px\";\n      }\n    }\n  } else {\n    if (editorRect.top < top && editorRect.bottom >= this.menu.offsetHeight + 10) {\n      this.floating = true;\n      var menuRect = this.menu.getBoundingClientRect();\n      this.menu.style.left = menuRect.left + \"px\";\n      this.menu.style.width = menuRect.width + \"px\";\n\n      if (scrollAncestor) {\n        this.menu.style.top = top + \"px\";\n      }\n\n      this.menu.style.position = \"fixed\";\n      this.spacer = crel(\"div\", {\n        class: prefix$2 + \"-spacer\",\n        style: \"height: \" + menuRect.height + \"px\"\n      });\n      parent.insertBefore(this.spacer, this.menu);\n    }\n  }\n};\n\nMenuBarView.prototype.destroy = function destroy() {\n  if (this.wrapper.parentNode) {\n    this.wrapper.parentNode.replaceChild(this.editorView.dom, this.wrapper);\n  }\n}; // Not precise, but close enough\n\n\nfunction selectionIsInverted(selection) {\n  if (selection.anchorNode == selection.focusNode) {\n    return selection.anchorOffset > selection.focusOffset;\n  }\n\n  return selection.anchorNode.compareDocumentPosition(selection.focusNode) == Node.DOCUMENT_POSITION_FOLLOWING;\n}\n\nfunction findWrappingScrollable(node) {\n  for (var cur = node.parentNode; cur; cur = cur.parentNode) {\n    if (cur.scrollHeight > cur.clientHeight) {\n      return cur;\n    }\n  }\n}\n\nfunction getAllWrapping(node) {\n  var res = [window];\n\n  for (var cur = node.parentNode; cur; cur = cur.parentNode) {\n    res.push(cur);\n  }\n\n  return res;\n}\n\nexport { Dropdown, DropdownSubmenu, MenuItem, blockTypeItem, icons, joinUpItem, liftItem, menuBar, redoItem, renderGrouped, selectParentNodeItem, undoItem, wrapItem };","map":{"version":3,"sources":["../src/icons.js","../src/menu.js","../src/menubar.js"],"names":["const","let","prefix","this","update"],"mappings":"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","sourcesContent":["const SVG = \"http://www.w3.org/2000/svg\"\nconst XLINK = \"http://www.w3.org/1999/xlink\"\n\nconst prefix = \"ProseMirror-icon\"\n\nfunction hashPath(path) {\n  let hash = 0\n  for (let i = 0; i < path.length; i++)\n    hash = (((hash << 5) - hash) + path.charCodeAt(i)) | 0\n  return hash\n}\n\nexport function getIcon(icon) {\n  let node = document.createElement(\"div\")\n  node.className = prefix\n  if (icon.path) {\n    let name = \"pm-icon-\" + hashPath(icon.path).toString(16)\n    if (!document.getElementById(name)) buildSVG(name, icon)\n    let svg = node.appendChild(document.createElementNS(SVG, \"svg\"))\n    svg.style.width = (icon.width / icon.height) + \"em\"\n    let use = svg.appendChild(document.createElementNS(SVG, \"use\"))\n    use.setAttributeNS(XLINK, \"href\", /([^#]*)/.exec(document.location)[1] + \"#\" + name)\n  } else if (icon.dom) {\n    node.appendChild(icon.dom.cloneNode(true))\n  } else {\n    node.appendChild(document.createElement(\"span\")).textContent = icon.text || ''\n    if (icon.css) node.firstChild.style.cssText = icon.css\n  }\n  return node\n}\n\nfunction buildSVG(name, data) {\n  let collection = document.getElementById(prefix + \"-collection\")\n  if (!collection) {\n    collection = document.createElementNS(SVG, \"svg\")\n    collection.id = prefix + \"-collection\"\n    collection.style.display = \"none\"\n    document.body.insertBefore(collection, document.body.firstChild)\n  }\n  let sym = document.createElementNS(SVG, \"symbol\")\n  sym.id = name\n  sym.setAttribute(\"viewBox\", \"0 0 \" + data.width + \" \" + data.height)\n  let path = sym.appendChild(document.createElementNS(SVG, \"path\"))\n  path.setAttribute(\"d\", data.path)\n  collection.appendChild(sym)\n}\n","import crel from \"crelt\"\nimport {lift, joinUp, selectParentNode, wrapIn, setBlockType} from \"prosemirror-commands\"\nimport {undo, redo} from \"prosemirror-history\"\n\nimport {getIcon} from \"./icons\"\n\nconst prefix = \"ProseMirror-menu\"\n\n// ::- An icon or label that, when clicked, executes a command.\nexport class MenuItem {\n  // :: (MenuItemSpec)\n  constructor(spec) {\n    // :: MenuItemSpec\n    // The spec used to create the menu item.\n    this.spec = spec\n  }\n\n  // :: (EditorView) → {dom: dom.Node, update: (EditorState) → bool}\n  // Renders the icon according to its [display\n  // spec](#menu.MenuItemSpec.display), and adds an event handler which\n  // executes the command when the representation is clicked.\n  render(view) {\n    let spec = this.spec\n    let dom = spec.render ? spec.render(view)\n        : spec.icon ? getIcon(spec.icon)\n        : spec.label ? crel(\"div\", null, translate(view, spec.label))\n        : null\n    if (!dom) throw new RangeError(\"MenuItem without icon or label property\")\n    if (spec.title) {\n      const title = (typeof spec.title === \"function\" ? spec.title(view.state) : spec.title)\n      dom.setAttribute(\"title\", translate(view, title))\n    }\n    if (spec.class) dom.classList.add(spec.class)\n    if (spec.css) dom.style.cssText += spec.css\n\n    dom.addEventListener(\"mousedown\", e => {\n      e.preventDefault()\n      if (!dom.classList.contains(prefix + \"-disabled\"))\n        spec.run(view.state, view.dispatch, view, e)\n    })\n\n    function update(state) {\n      if (spec.select) {\n        let selected = spec.select(state)\n        dom.style.display = selected ? \"\" : \"none\"\n        if (!selected) return false\n      }\n      let enabled = true\n      if (spec.enable) {\n        enabled = spec.enable(state) || false\n        setClass(dom, prefix + \"-disabled\", !enabled)\n      }\n      if (spec.active) {\n        let active = enabled && spec.active(state) || false\n        setClass(dom, prefix + \"-active\", active)\n      }\n      return true\n    }\n\n    return {dom, update}\n  }\n}\n\nfunction translate(view, text) {\n  return view._props.translate ? view._props.translate(text) : text\n}\n\n// MenuItemSpec:: interface\n// The configuration object passed to the `MenuItem` constructor.\n//\n//   run:: (EditorState, (Transaction), EditorView, dom.Event)\n//   The function to execute when the menu item is activated.\n//\n//   select:: ?(EditorState) → bool\n//   Optional function that is used to determine whether the item is\n//   appropriate at the moment. Deselected items will be hidden.\n//\n//   enable:: ?(EditorState) → bool\n//   Function that is used to determine if the item is enabled. If\n//   given and returning false, the item will be given a disabled\n//   styling.\n//\n//   active:: ?(EditorState) → bool\n//   A predicate function to determine whether the item is 'active' (for\n//   example, the item for toggling the strong mark might be active then\n//   the cursor is in strong text).\n//\n//   render:: ?(EditorView) → dom.Node\n//   A function that renders the item. You must provide either this,\n//   [`icon`](#menu.MenuItemSpec.icon), or [`label`](#MenuItemSpec.label).\n//\n//   icon:: ?Object\n//   Describes an icon to show for this item. The object may specify\n//   an SVG icon, in which case its `path` property should be an [SVG\n//   path\n//   spec](https://developer.mozilla.org/en-US/docs/Web/SVG/Attribute/d),\n//   and `width` and `height` should provide the viewbox in which that\n//   path exists. Alternatively, it may have a `text` property\n//   specifying a string of text that makes up the icon, with an\n//   optional `css` property giving additional CSS styling for the\n//   text. _Or_ it may contain `dom` property containing a DOM node.\n//\n//   label:: ?string\n//   Makes the item show up as a text label. Mostly useful for items\n//   wrapped in a [drop-down](#menu.Dropdown) or similar menu. The object\n//   should have a `label` property providing the text to display.\n//\n//   title:: ?union<string, (EditorState) → string>\n//   Defines DOM title (mouseover) text for the item.\n//\n//   class:: ?string\n//   Optionally adds a CSS class to the item's DOM representation.\n//\n//   css:: ?string\n//   Optionally adds a string of inline CSS to the item's DOM\n//   representation.\n\nlet lastMenuEvent = {time: 0, node: null}\nfunction markMenuEvent(e) {\n  lastMenuEvent.time = Date.now()\n  lastMenuEvent.node = e.target\n}\nfunction isMenuEvent(wrapper) {\n  return Date.now() - 100 < lastMenuEvent.time &&\n    lastMenuEvent.node && wrapper.contains(lastMenuEvent.node)\n}\n\n// ::- A drop-down menu, displayed as a label with a downwards-pointing\n// triangle to the right of it.\nexport class Dropdown {\n  // :: ([MenuElement], ?Object)\n  // Create a dropdown wrapping the elements. Options may include\n  // the following properties:\n  //\n  // **`label`**`: string`\n  //   : The label to show on the drop-down control.\n  //\n  // **`title`**`: string`\n  //   : Sets the\n  //     [`title`](https://developer.mozilla.org/en-US/docs/Web/HTML/Global_attributes/title)\n  //     attribute given to the menu control.\n  //\n  // **`class`**`: string`\n  //   : When given, adds an extra CSS class to the menu control.\n  //\n  // **`css`**`: string`\n  //   : When given, adds an extra set of CSS styles to the menu control.\n  constructor(content, options) {\n    this.options = options || {}\n    this.content = Array.isArray(content) ? content : [content]\n  }\n\n  // :: (EditorView) → {dom: dom.Node, update: (EditorState)}\n  // Render the dropdown menu and sub-items.\n  render(view) {\n    let content = renderDropdownItems(this.content, view)\n\n    let label = crel(\"div\", {class: prefix + \"-dropdown \" + (this.options.class || \"\"),\n                             style: this.options.css},\n                     translate(view, this.options.label))\n    if (this.options.title) label.setAttribute(\"title\", translate(view, this.options.title))\n    let wrap = crel(\"div\", {class: prefix + \"-dropdown-wrap\"}, label)\n    let open = null, listeningOnClose = null\n    let close = () => {\n      if (open && open.close()) {\n        open = null\n        window.removeEventListener(\"mousedown\", listeningOnClose)\n      }\n    }\n    label.addEventListener(\"mousedown\", e => {\n      e.preventDefault()\n      markMenuEvent(e)\n      if (open) {\n        close()\n      } else {\n        open = this.expand(wrap, content.dom)\n        window.addEventListener(\"mousedown\", listeningOnClose = () => {\n          if (!isMenuEvent(wrap)) close()\n        })\n      }\n    })\n\n    function update(state) {\n      let inner = content.update(state)\n      wrap.style.display = inner ? \"\" : \"none\"\n      return inner\n    }\n\n    return {dom: wrap, update}\n  }\n\n  expand(dom, items) {\n    let menuDOM = crel(\"div\", {class: prefix + \"-dropdown-menu \" + (this.options.class || \"\")}, items)\n\n    let done = false\n    function close() {\n      if (done) return\n      done = true\n      dom.removeChild(menuDOM)\n      return true\n    }\n    dom.appendChild(menuDOM)\n    return {close, node: menuDOM}\n  }\n}\n\nfunction renderDropdownItems(items, view) {\n  let rendered = [], updates = []\n  for (let i = 0; i < items.length; i++) {\n    let {dom, update} = items[i].render(view)\n    rendered.push(crel(\"div\", {class: prefix + \"-dropdown-item\"}, dom))\n    updates.push(update)\n  }\n  return {dom: rendered, update: combineUpdates(updates, rendered)}\n}\n\nfunction combineUpdates(updates, nodes) {\n  return state => {\n    let something = false\n    for (let i = 0; i < updates.length; i++) {\n      let up = updates[i](state)\n      nodes[i].style.display = up ? \"\" : \"none\"\n      if (up) something = true\n    }\n    return something\n  }\n}\n\n// ::- Represents a submenu wrapping a group of elements that start\n// hidden and expand to the right when hovered over or tapped.\nexport class DropdownSubmenu {\n  // :: ([MenuElement], ?Object)\n  // Creates a submenu for the given group of menu elements. The\n  // following options are recognized:\n  //\n  // **`label`**`: string`\n  //   : The label to show on the submenu.\n  constructor(content, options) {\n    this.options = options || {}\n    this.content = Array.isArray(content) ? content : [content]\n  }\n\n  // :: (EditorView) → {dom: dom.Node, update: (EditorState) → bool}\n  // Renders the submenu.\n  render(view) {\n    let items = renderDropdownItems(this.content, view)\n\n    let label = crel(\"div\", {class: prefix + \"-submenu-label\"}, translate(view, this.options.label))\n    let wrap = crel(\"div\", {class: prefix + \"-submenu-wrap\"}, label,\n                   crel(\"div\", {class: prefix + \"-submenu\"}, items.dom))\n    let listeningOnClose = null\n    label.addEventListener(\"mousedown\", e => {\n      e.preventDefault()\n      markMenuEvent(e)\n      setClass(wrap, prefix + \"-submenu-wrap-active\")\n      if (!listeningOnClose)\n        window.addEventListener(\"mousedown\", listeningOnClose = () => {\n          if (!isMenuEvent(wrap)) {\n            wrap.classList.remove(prefix + \"-submenu-wrap-active\")\n            window.removeEventListener(\"mousedown\", listeningOnClose)\n            listeningOnClose = null\n          }\n        })\n    })\n\n    function update(state) {\n      let inner = items.update(state)\n      wrap.style.display = inner ? \"\" : \"none\"\n      return inner\n    }\n    return {dom: wrap, update}\n  }\n}\n\n// :: (EditorView, [union<MenuElement, [MenuElement]>]) → {dom: ?dom.DocumentFragment, update: (EditorState) → bool}\n// Render the given, possibly nested, array of menu elements into a\n// document fragment, placing separators between them (and ensuring no\n// superfluous separators appear when some of the groups turn out to\n// be empty).\nexport function renderGrouped(view, content) {\n  let result = document.createDocumentFragment()\n  let updates = [], separators = []\n  for (let i = 0; i < content.length; i++) {\n    let items = content[i], localUpdates = [], localNodes = []\n    for (let j = 0; j < items.length; j++) {\n      let {dom, update} = items[j].render(view)\n      let span = crel(\"span\", {class: prefix + \"item\"}, dom)\n      result.appendChild(span)\n      localNodes.push(span)\n      localUpdates.push(update)\n    }\n    if (localUpdates.length) {\n      updates.push(combineUpdates(localUpdates, localNodes))\n      if (i < content.length - 1)\n        separators.push(result.appendChild(separator()))\n    }\n  }\n\n  function update(state) {\n    let something = false, needSep = false\n    for (let i = 0; i < updates.length; i++) {\n      let hasContent = updates[i](state)\n      if (i) separators[i - 1].style.display = needSep && hasContent ? \"\" : \"none\"\n      needSep = hasContent\n      if (hasContent) something = true\n    }\n    return something\n  }\n  return {dom: result, update}\n}\n\nfunction separator() {\n  return crel(\"span\", {class: prefix + \"separator\"})\n}\n\n// :: Object\n// A set of basic editor-related icons. Contains the properties\n// `join`, `lift`, `selectParentNode`, `undo`, `redo`, `strong`, `em`,\n// `code`, `link`, `bulletList`, `orderedList`, and `blockquote`, each\n// holding an object that can be used as the `icon` option to\n// `MenuItem`.\nexport const icons = {\n  join: {\n    width: 800, height: 900,\n    path: \"M0 75h800v125h-800z M0 825h800v-125h-800z M250 400h100v-100h100v100h100v100h-100v100h-100v-100h-100z\"\n  },\n  lift: {\n    width: 1024, height: 1024,\n    path: \"M219 310v329q0 7-5 12t-12 5q-8 0-13-5l-164-164q-5-5-5-13t5-13l164-164q5-5 13-5 7 0 12 5t5 12zM1024 749v109q0 7-5 12t-12 5h-987q-7 0-12-5t-5-12v-109q0-7 5-12t12-5h987q7 0 12 5t5 12zM1024 530v109q0 7-5 12t-12 5h-621q-7 0-12-5t-5-12v-109q0-7 5-12t12-5h621q7 0 12 5t5 12zM1024 310v109q0 7-5 12t-12 5h-621q-7 0-12-5t-5-12v-109q0-7 5-12t12-5h621q7 0 12 5t5 12zM1024 91v109q0 7-5 12t-12 5h-987q-7 0-12-5t-5-12v-109q0-7 5-12t12-5h987q7 0 12 5t5 12z\"\n  },\n  selectParentNode: {text: \"\\u2b1a\", css: \"font-weight: bold\"},\n  undo: {\n    width: 1024, height: 1024,\n    path: \"M761 1024c113-206 132-520-313-509v253l-384-384 384-384v248c534-13 594 472 313 775z\"\n  },\n  redo: {\n    width: 1024, height: 1024,\n    path: \"M576 248v-248l384 384-384 384v-253c-446-10-427 303-313 509-280-303-221-789 313-775z\"\n  },\n  strong: {\n    width: 805, height: 1024,\n    path: \"M317 869q42 18 80 18 214 0 214-191 0-65-23-102-15-25-35-42t-38-26-46-14-48-6-54-1q-41 0-57 5 0 30-0 90t-0 90q0 4-0 38t-0 55 2 47 6 38zM309 442q24 4 62 4 46 0 81-7t62-25 42-51 14-81q0-40-16-70t-45-46-61-24-70-8q-28 0-74 7 0 28 2 86t2 86q0 15-0 45t-0 45q0 26 0 39zM0 950l1-53q8-2 48-9t60-15q4-6 7-15t4-19 3-18 1-21 0-19v-37q0-561-12-585-2-4-12-8t-25-6-28-4-27-2-17-1l-2-47q56-1 194-6t213-5q13 0 39 0t38 0q40 0 78 7t73 24 61 40 42 59 16 78q0 29-9 54t-22 41-36 32-41 25-48 22q88 20 146 76t58 141q0 57-20 102t-53 74-78 48-93 27-100 8q-25 0-75-1t-75-1q-60 0-175 6t-132 6z\"\n  },\n  em: {\n    width: 585, height: 1024,\n    path: \"M0 949l9-48q3-1 46-12t63-21q16-20 23-57 0-4 35-165t65-310 29-169v-14q-13-7-31-10t-39-4-33-3l10-58q18 1 68 3t85 4 68 1q27 0 56-1t69-4 56-3q-2 22-10 50-17 5-58 16t-62 19q-4 10-8 24t-5 22-4 26-3 24q-15 84-50 239t-44 203q-1 5-7 33t-11 51-9 47-3 32l0 10q9 2 105 17-1 25-9 56-6 0-18 0t-18 0q-16 0-49-5t-49-5q-78-1-117-1-29 0-81 5t-69 6z\"\n  },\n  code: {\n    width: 896, height: 1024,\n    path: \"M608 192l-96 96 224 224-224 224 96 96 288-320-288-320zM288 192l-288 320 288 320 96-96-224-224 224-224-96-96z\"\n  },\n  link: {\n    width: 951, height: 1024,\n    path: \"M832 694q0-22-16-38l-118-118q-16-16-38-16-24 0-41 18 1 1 10 10t12 12 8 10 7 14 2 15q0 22-16 38t-38 16q-8 0-15-2t-14-7-10-8-12-12-10-10q-18 17-18 41 0 22 16 38l117 118q15 15 38 15 22 0 38-14l84-83q16-16 16-38zM430 292q0-22-16-38l-117-118q-16-16-38-16-22 0-38 15l-84 83q-16 16-16 38 0 22 16 38l118 118q15 15 38 15 24 0 41-17-1-1-10-10t-12-12-8-10-7-14-2-15q0-22 16-38t38-16q8 0 15 2t14 7 10 8 12 12 10 10q18-17 18-41zM941 694q0 68-48 116l-84 83q-47 47-116 47-69 0-116-48l-117-118q-47-47-47-116 0-70 50-119l-50-50q-49 50-118 50-68 0-116-48l-118-118q-48-48-48-116t48-116l84-83q47-47 116-47 69 0 116 48l117 118q47 47 47 116 0 70-50 119l50 50q49-50 118-50 68 0 116 48l118 118q48 48 48 116z\"\n  },\n  bulletList: {\n    width: 768, height: 896,\n    path: \"M0 512h128v-128h-128v128zM0 256h128v-128h-128v128zM0 768h128v-128h-128v128zM256 512h512v-128h-512v128zM256 256h512v-128h-512v128zM256 768h512v-128h-512v128z\"\n  },\n  orderedList: {\n    width: 768, height: 896,\n    path: \"M320 512h448v-128h-448v128zM320 768h448v-128h-448v128zM320 128v128h448v-128h-448zM79 384h78v-256h-36l-85 23v50l43-2v185zM189 590c0-36-12-78-96-78-33 0-64 6-83 16l1 66c21-10 42-15 67-15s32 11 32 28c0 26-30 58-110 112v50h192v-67l-91 2c49-30 87-66 87-113l1-1z\"\n  },\n  blockquote: {\n    width: 640, height: 896,\n    path: \"M0 448v256h256v-256h-128c0 0 0-128 128-128v-128c0 0-256 0-256 256zM640 320v-128c0 0-256 0-256 256v256h256v-256h-128c0 0 0-128 128-128z\"\n  }\n}\n\n// :: MenuItem\n// Menu item for the `joinUp` command.\nexport const joinUpItem = new MenuItem({\n  title: \"Join with above block\",\n  run: joinUp,\n  select: state => joinUp(state),\n  icon: icons.join\n})\n\n// :: MenuItem\n// Menu item for the `lift` command.\nexport const liftItem = new MenuItem({\n  title: \"Lift out of enclosing block\",\n  run: lift,\n  select: state => lift(state),\n  icon: icons.lift\n})\n\n// :: MenuItem\n// Menu item for the `selectParentNode` command.\nexport const selectParentNodeItem = new MenuItem({\n  title: \"Select parent node\",\n  run: selectParentNode,\n  select: state => selectParentNode(state),\n  icon: icons.selectParentNode\n})\n\n// :: MenuItem\n// Menu item for the `undo` command.\nexport let undoItem = new MenuItem({\n  title: \"Undo last change\",\n  run: undo,\n  enable: state => undo(state),\n  icon: icons.undo\n})\n\n// :: MenuItem\n// Menu item for the `redo` command.\nexport let redoItem = new MenuItem({\n  title: \"Redo last undone change\",\n  run: redo,\n  enable: state => redo(state),\n  icon: icons.redo\n})\n\n// :: (NodeType, Object) → MenuItem\n// Build a menu item for wrapping the selection in a given node type.\n// Adds `run` and `select` properties to the ones present in\n// `options`. `options.attrs` may be an object or a function.\nexport function wrapItem(nodeType, options) {\n  let passedOptions = {\n    run(state, dispatch) {\n      // FIXME if (options.attrs instanceof Function) options.attrs(state, attrs => wrapIn(nodeType, attrs)(state))\n      return wrapIn(nodeType, options.attrs)(state, dispatch)\n    },\n    select(state) {\n      return wrapIn(nodeType, options.attrs instanceof Function ? null : options.attrs)(state)\n    }\n  }\n  for (let prop in options) passedOptions[prop] = options[prop]\n  return new MenuItem(passedOptions)\n}\n\n// :: (NodeType, Object) → MenuItem\n// Build a menu item for changing the type of the textblock around the\n// selection to the given type. Provides `run`, `active`, and `select`\n// properties. Others must be given in `options`. `options.attrs` may\n// be an object to provide the attributes for the textblock node.\nexport function blockTypeItem(nodeType, options) {\n  let command = setBlockType(nodeType, options.attrs)\n  let passedOptions = {\n    run: command,\n    enable(state) { return command(state) },\n    active(state) {\n      let {$from, to, node} = state.selection\n      if (node) return node.hasMarkup(nodeType, options.attrs)\n      return to <= $from.end() && $from.parent.hasMarkup(nodeType, options.attrs)\n    }\n  }\n  for (let prop in options) passedOptions[prop] = options[prop]\n  return new MenuItem(passedOptions)\n}\n\n// Work around classList.toggle being broken in IE11\nfunction setClass(dom, cls, on) {\n  if (on) dom.classList.add(cls)\n  else dom.classList.remove(cls)\n}\n","import crel from \"crelt\"\nimport {Plugin} from \"prosemirror-state\"\n\nimport {renderGrouped} from \"./menu\"\n\nconst prefix = \"ProseMirror-menubar\"\n\nfunction isIOS() {\n  if (typeof navigator == \"undefined\") return false\n  let agent = navigator.userAgent\n  return !/Edge\\/\\d/.test(agent) && /AppleWebKit/.test(agent) && /Mobile\\/\\w+/.test(agent)\n}\n\n// :: (Object) → Plugin\n// A plugin that will place a menu bar above the editor. Note that\n// this involves wrapping the editor in an additional `<div>`.\n//\n//   options::-\n//   Supports the following options:\n//\n//     content:: [[MenuElement]]\n//     Provides the content of the menu, as a nested array to be\n//     passed to `renderGrouped`.\n//\n//     floating:: ?bool\n//     Determines whether the menu floats, i.e. whether it sticks to\n//     the top of the viewport when the editor is partially scrolled\n//     out of view.\nexport function menuBar(options) {\n  return new Plugin({\n    view(editorView) { return new MenuBarView(editorView, options) }\n  })\n}\n\nclass MenuBarView {\n  constructor(editorView, options) {\n    this.editorView = editorView\n    this.options = options\n\n    this.wrapper = crel(\"div\", {class: prefix + \"-wrapper\"})\n    this.menu = this.wrapper.appendChild(crel(\"div\", {class: prefix}))\n    this.menu.className = prefix\n    this.spacer = null\n\n    editorView.dom.parentNode.replaceChild(this.wrapper, editorView.dom)\n    this.wrapper.appendChild(editorView.dom)\n\n    this.maxHeight = 0\n    this.widthForMaxHeight = 0\n    this.floating = false\n\n    let {dom, update} = renderGrouped(this.editorView, this.options.content)\n    this.contentUpdate = update\n    this.menu.appendChild(dom)\n    this.update()\n\n    if (options.floating && !isIOS()) {\n      this.updateFloat()\n      let potentialScrollers = getAllWrapping(this.wrapper)\n      this.scrollFunc = (e) => {\n        let root = this.editorView.root\n        if (!(root.body || root).contains(this.wrapper)) {\n            potentialScrollers.forEach(el => el.removeEventListener(\"scroll\", this.scrollFunc))\n        } else {\n            this.updateFloat(e.target.getBoundingClientRect && e.target)\n        }\n      }\n      potentialScrollers.forEach(el => el.addEventListener('scroll', this.scrollFunc))\n    }\n  }\n\n  update() {\n    this.contentUpdate(this.editorView.state)\n\n    if (this.floating) {\n      this.updateScrollCursor()\n    } else {\n      if (this.menu.offsetWidth != this.widthForMaxHeight) {\n        this.widthForMaxHeight = this.menu.offsetWidth\n        this.maxHeight = 0\n      }\n      if (this.menu.offsetHeight > this.maxHeight) {\n        this.maxHeight = this.menu.offsetHeight\n        this.menu.style.minHeight = this.maxHeight + \"px\"\n      }\n    }\n  }\n\n  updateScrollCursor() {\n    let selection = this.editorView.root.getSelection()\n    if (!selection.focusNode) return\n    let rects = selection.getRangeAt(0).getClientRects()\n    let selRect = rects[selectionIsInverted(selection) ? 0 : rects.length - 1]\n    if (!selRect) return\n    let menuRect = this.menu.getBoundingClientRect()\n    if (selRect.top < menuRect.bottom && selRect.bottom > menuRect.top) {\n      let scrollable = findWrappingScrollable(this.wrapper)\n      if (scrollable) scrollable.scrollTop -= (menuRect.bottom - selRect.top)\n    }\n  }\n\n  updateFloat(scrollAncestor) {\n    let parent = this.wrapper, editorRect = parent.getBoundingClientRect(),\n        top = scrollAncestor ? Math.max(0, scrollAncestor.getBoundingClientRect().top) : 0\n\n    if (this.floating) {\n      if (editorRect.top >= top || editorRect.bottom < this.menu.offsetHeight + 10) {\n        this.floating = false\n        this.menu.style.position = this.menu.style.left = this.menu.style.top = this.menu.style.width = \"\"\n        this.menu.style.display = \"\"\n        this.spacer.parentNode.removeChild(this.spacer)\n        this.spacer = null\n      } else {\n        let border = (parent.offsetWidth - parent.clientWidth) / 2\n        this.menu.style.left = (editorRect.left + border) + \"px\"\n        this.menu.style.display = (editorRect.top > window.innerHeight ? \"none\" : \"\")\n        if (scrollAncestor) this.menu.style.top = top + \"px\"\n      }\n    } else {\n      if (editorRect.top < top && editorRect.bottom >= this.menu.offsetHeight + 10) {\n        this.floating = true\n        let menuRect = this.menu.getBoundingClientRect()\n        this.menu.style.left = menuRect.left + \"px\"\n        this.menu.style.width = menuRect.width + \"px\"\n        if (scrollAncestor) this.menu.style.top = top + \"px\"\n        this.menu.style.position = \"fixed\"\n        this.spacer = crel(\"div\", {class: prefix + \"-spacer\", style: `height: ${menuRect.height}px`})\n        parent.insertBefore(this.spacer, this.menu)\n      }\n    }\n  }\n\n  destroy() {\n    if (this.wrapper.parentNode)\n      this.wrapper.parentNode.replaceChild(this.editorView.dom, this.wrapper)\n  }\n}\n\n// Not precise, but close enough\nfunction selectionIsInverted(selection) {\n  if (selection.anchorNode == selection.focusNode) return selection.anchorOffset > selection.focusOffset\n  return selection.anchorNode.compareDocumentPosition(selection.focusNode) == Node.DOCUMENT_POSITION_FOLLOWING\n}\n\nfunction findWrappingScrollable(node) {\n  for (let cur = node.parentNode; cur; cur = cur.parentNode)\n    if (cur.scrollHeight > cur.clientHeight) return cur\n}\n\nfunction getAllWrapping(node) {\n    let res = [window]\n    for (let cur = node.parentNode; cur; cur = cur.parentNode)\n        res.push(cur)\n    return res\n}\n"]},"metadata":{},"sourceType":"module"}